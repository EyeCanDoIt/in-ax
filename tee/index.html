---
title: Echo Game..
layout: template
filename: echo
---

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TEE Anatomy Guess — Echo Game</title>

  <style>
    html,body{height:100%}
    body{
      margin:0;
      background:
        radial-gradient(1200px 800px at 10% -10%, #1a2a55 0%, rgba(26,42,85,0) 60%),
        radial-gradient(1000px 700px at 100% 0%, #0b1738 0%, rgba(11,23,56,0) 55%),
        linear-gradient(180deg, #070e1e 0%, #0a1228 100%);
      color:#e8eefc;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }

    .echo-root{max-width:1100px;margin:28px auto 48px;padding:0 18px}
    .echo-page-title{margin:0 0 4px;text-align:center;letter-spacing:.2px}
    .echo-subtitle{margin:0 0 22px;text-align:center;color:#9aa8c0}

    :root{
      --echo-card:#0f172a; --echo-muted:#90a4bf; --echo-accent:#5eead4; --echo-accent2:#93c5fd;
      --echo-danger:#f87171; --echo-success:#34d399; --echo-text:#e8eefc; --echo-dim:#c2cce0;
      --echo-btn:#16223a; --echo-btnH:#1d2a48; --echo-ring:#3b82f6;
    }

    .echo-app{color:var(--echo-text)}
    .echo-header{display:flex;align-items:center;justify-content:space-between;gap:16px;padding:6px 0 12px}
    .echo-title-wrap{display:flex;align-items:baseline;gap:.6rem}
    .echo-title{font-size:clamp(1.15rem,1rem + 1.6vw,1.8rem);margin:0}
    .echo-sub{color:var(--echo-muted);font-size:.98rem}
    .echo-pill{padding:8px 12px;border-radius:999px;background:rgba(23,32,54,.7);border:1px solid rgba(255,255,255,.08);color:var(--echo-dim);font-weight:700}

    .echo-card{
      background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.10);
      border-radius:18px;
      box-shadow: 0 24px 48px rgba(0,0,0,.35), 0 0 0 1px rgba(94,234,212,.08) inset;
      overflow:hidden; backdrop-filter: blur(2px);
    }

    .echo-stage{padding:18px 18px 0;display:flex;justify-content:center}

    .echo-image-wrap{
      position: relative;
      width: min(100%, 860px);
      max-height: 65vh;
      aspect-ratio: var(--echo-ar, 4 / 3);
      margin: 0 auto 12px;
      border-radius: 16px;
      overflow: hidden;
      background: #0e1628;
      border: 1px solid rgba(255,255,255,.06);
      box-shadow: 0 10px 30px rgba(0,0,0,.45), 0 0 0 1px rgba(147,197,253,.06) inset;
    }

    .echo-image{display:block;width:100%;height:100%;object-fit:contain;background:#000}
    @media (max-width: 480px){ .echo-image-wrap{ max-height: 48vh; } }

    .echo-topbanner{
      margin: 12px 18px 0;
      padding: 10px 12px;
      border-radius: 12px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.12);
      color: var(--echo-dim);
      font-weight: 700;
    }

    .echo-overlay{position:absolute;inset:0;pointer-events:none}
    .echo-arrow-label{
      position:absolute;transform:translate(-50%,-50%);
      background:rgba(8,18,32,.88);border:1px solid rgba(148,163,184,.35);
      padding:6px 10px;border-radius:999px;font-weight:700;font-size:.95rem;color:var(--echo-text)
    }

    .echo-answers{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px;padding:16px 18px 18px}
    @media (min-width:840px){.echo-answers{grid-template-columns:repeat(4,minmax(0,1fr));}}
    .echo-btn{
      appearance:none;border:1px solid rgba(255,255,255,.10);
      background:linear-gradient(180deg, rgba(30,44,78,.95), rgba(22,34,58,.95));
      color:var(--echo-text);
      border-radius:12px;padding:12px 14px;font-weight:700;cursor:pointer;
      transition:transform .16s ease, box-shadow .16s ease, border-color .16s ease, background .16s ease;
      box-shadow: 0 10px 18px rgba(0,0,0,.25);
    }
    .echo-btn:hover{background:var(--echo-btnH);transform:translateY(-1px);border-color:rgba(94,234,212,.35);box-shadow:0 12px 22px rgba(0,0,0,.32)}
    .echo-btn:focus-visible{outline:2px solid var(--echo-ring);outline-offset:2px}
    .echo-btn[disabled]{opacity:.55;cursor:not-allowed}
    .echo-btn.echo-correct{background:rgba(52,211,153,.18);border-color:rgba(52,211,153,.55)}
    .echo-btn.echo-wrong{background:rgba(248,113,113,.16);border-color:rgba(248,113,113,.55)}

    .echo-footer{display:flex;align-items:center;justify-content:space-between;padding:12px 18px 18px;gap:12px}
    .echo-progress{position:relative;height:10px;flex:1 1 auto;background:rgba(255,255,255,.10);border-radius:999px;overflow:hidden;border:1px solid rgba(255,255,255,.08)}
    .echo-bar{position:absolute;inset:0 100% 0 0;background:linear-gradient(90deg,var(--echo-accent),var(--echo-accent2));transition:inset .35s ease}
    .echo-controls{display:flex;gap:8px}
    .echo-link{background:transparent;border:1px solid rgba(255,255,255,.18);color:#e6edf9;border-radius:999px;padding:8px 12px;cursor:pointer}
    .echo-link:hover{background:rgba(255,255,255,.08)}

    .echo-toast{position:fixed;left:50%;top:16px;transform:translateX(-50%) translateY(-12px);opacity:0;background:#0f1a2c;color:#e6edf9;
      border:1px solid rgba(255,255,255,.12);border-radius:10px;padding:10px 12px;font-weight:700;transition:all .25s ease;z-index:1000}
    .echo-toast.echo-show{transform:translateX(-50%) translateY(0);opacity:1}

    .echo-svg{position:absolute;inset:0;width:100%;height:100%}
    .echo-arrow-line{stroke:#60a5fa;stroke-width:4;filter:drop-shadow(0 0 2px rgba(96,165,250,.8))}
    .echo-arrow-head{fill:#60a5fa}
    .echo-shake{animation:echo-shake .28s linear 1}
    @keyframes echo-shake{0%{transform:translateX(0)}25%{transform:translateX(-4px)}50%{transform:translateX(4px)}75%{transform:translateX(-4px)}100%{transform:translateX(0)}}
  </style>
</head>
<body>

  <div class="echo-root">
    <h2 class="echo-page-title">Echocardiography Game</h2>
    <div class="echo-subtitle">Echo Game Version 0.001</div>

    <div class="echo-app">
      <div class="echo-header">
        <div class="echo-title-wrap">
          <h1 class="echo-title">TEE Anatomy Guess</h1>
          <span class="echo-sub">Identify the labelled structure to advance</span>
        </div>
        <div class="echo-meta">
          <span id="echo-scorePill" class="echo-pill">Score: 0</span>
          <span id="echo-qPill" class="echo-pill">1 / 1</span>
        </div>
      </div>

      <section class="echo-card">
        <div id="echo-topBanner" class="echo-topbanner" hidden></div>

        <div class="echo-stage">
          <div id="echo-imageWrap" class="echo-image-wrap">
            <video id="echo-video" class="echo-image" playsinline muted preload="metadata" style="display:none"></video>
            <img id="echo-image" class="echo-image" src="" alt="TEE question image" />
            <div id="echo-overlay" class="echo-overlay"></div>
          </div>
        </div>

        <div id="echo-answers" class="echo-answers" aria-live="polite"></div>

        <div class="echo-footer">
          <div class="echo-progress"><div id="echo-bar" class="echo-bar"></div></div>
          <div class="echo-controls">
            <button id="echo-skipBtn" class="echo-link" title="Skip question">Skip</button>
            <button id="echo-restartBtn" class="echo-link" title="Restart game">Restart</button>
          </div>
        </div>
      </section>
    </div>

    <div id="echo-toast" class="echo-toast" role="status" aria-live="polite"></div>
  </div>

  <script>
    // ------------ Data: use RELATIVE paths ------------
    const ECHO_QUESTIONS = [
      { image: "../images/4chamber.jpeg",
        label: "Left Ventricle", target: { x: 64, y: 63 },
        choices: ["Mitral Valve","Aortic Valve","Left Ventricle","Right Ventricle"],
        answer: "Left Ventricle", hint: "Midesophageal 4-chamber view" },
      { image: "../images/4chamber.jpeg",
        label: "Left Atrium", target: { x: 58, y: 35 },
        choices: ["Inferior Vena Cava","Superior Vena Cava","Left Atrium","Aortic Valve"],
        answer: "Left Atrium", hint: "Midesophageal 4-chamber view" },
      { image: "../images/4chamber.jpeg",
        label: "Tricuspid Septal Leaflet", target: { x: 47.4, y: 46.2 },
        choices: ["Tricuspid Septal Leaflet","Tricuspid Valve","Left Atrial Appendage","Pulmonary Vein"],
        answer: "Tricuspid Septal Leaflet", hint: "Midesophageal 4-chamber view" },
      { image: "../images/4chamber.jpeg",
        label: "Tricuspid Anterior Leaflet", target: { x: 42.8, y: 50.1 },
        choices: ["Septal Leaflet","Tricuspid Anterior Leaflet","Left Atrial Appendage","Pulmonary Vein"],
        answer: "Tricuspid Anterior Leaflet", hint: "Midesophageal 4-chamber view" },
      { image: "../images/ME2chamber.png",
        label: "Left Ventricle", target: { x: 46, y: 48 },
        choices: ["Left Atrium","Left Ventricle","Mitral Valve Anterior Leaflet","Mitral Valve Posterior Leaflet"],
        answer: "Left Ventricle", hint: "Mid Esophageal 2 Chamber View" },
      { image: "../images/ME2chamber.png",
        label: "Mitral Valve Posterior Leaflet", target: { x: 43, y: 33 },
        choices: ["Left Ventricle Inferior Wall","Left Ventricle Anterior Wall","Mitral Valve Anterior Leaflet","Mitral Valve Posterior Leaflet"],
        answer: "Mitral Valve Posterior Leaflet", hint: "Mid Esophageal 2 Chamber View" },
      { image: "../images/ME2chamber.png",
        label: "Mitral Valve Anterior Leaflet", target: { x: 51.2, y: 30.5 },
        choices: ["Left Ventricle Inferior Wall","Left Ventricle Anterior Wall","Mitral Valve Anterior Leaflet","Mitral Valve Posterior Leaflet"],
        answer: "Mitral Valve Anterior Leaflet", hint: "Mid Esophageal 2 Chamber View" },
      { image: "../images/LVHypertrophy.png",
        label: "LV Hypertrophy", target: { x: 51.2, y: 30.5 },
        choices: ["LA Hypertrophy","RV Hypertrophy","LV Hypertrophy","LA Appendage"],
        answer: "LV Hypertrophy", hint: "Short axis view" },
      { image: "../images/LVHypertrophy.png",
        label: "LAD", target: { x: 49.3, y: 25.6 },
        choices: ["LAD","LCx","RCA","LMA"],
        answer: "LAD", hint: "Short axis view",
        topText: "Which artery supplies this wall?", topColor: "#ef4444" },
      { sources: [
          { src: "../images/MELongAxisVid1.mp4", type: "video/mp4" },
          { src: "../images/MELongAxisVid1.MOV", type: "video/quicktime" }
        ],
        autoplay: true, start: 1.0, end: 3.0,
        label: "Mid-Esophageal Long Axis View",
        target: { x: 50, y: 40 }, // give the video an arrow too
        choices: ["Mid-Esophageal Long Axis View","Mid-Esophageal Two Chamber View","Mid-Esophageal Four Chamber View","Bicaval View"],
        answer: "Mid-Esophageal Long Axis View", hint: "ME LAX",
        topText: "Name the TEE View:", topColor: "#ef4444" },
    ];

    // ------------ Helpers ------------
    const $E = (sel, el=document) => el.querySelector(sel);
    const shuffle = (arr) => { const a = arr.slice(); for (let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]] } return a };
    const clamp = (n,min,max)=>Math.max(min,Math.min(max,n));

    // ------------ State ------------
    let order = shuffle([...Array(ECHO_QUESTIONS.length).keys()]);
    // Ensure first question has a target so an arrow shows immediately
    while (ECHO_QUESTIONS[order[0]] && !ECHO_QUESTIONS[order[0]].target) {
      order.push(order.shift());
    }
    let idx = 0, score = 0;

    const videoEl   = $E("#echo-video");
    const imageEl   = $E("#echo-image");
    const overlayEl = $E("#echo-overlay");
    const answersEl = $E("#echo-answers");
    const scorePill = $E("#echo-scorePill");
    const qPill     = $E("#echo-qPill");
    const bar       = $E("#echo-bar");
    const toast     = $E("#echo-toast");
    const skipBtn   = $E("#echo-skipBtn");
    const restartBtn= $E("#echo-restartBtn");
    const wrapEl    = $E("#echo-imageWrap");
    const topBanner = $E("#echo-topBanner");

    skipBtn.addEventListener('click', nextQuestion);
    restartBtn.addEventListener('click', restart);
    window.addEventListener('resize', redrawOverlay);

    function setAspectFromMedia(){
      if (videoEl && videoEl.style.display !== 'none' && videoEl.videoWidth && videoEl.videoHeight){
        wrapEl.style.setProperty('--echo-ar', `${videoEl.videoWidth} / ${videoEl.videoHeight}`);
      } else if (imageEl.naturalWidth && imageEl.naturalHeight){
        wrapEl.style.setProperty('--echo-ar', `${imageEl.naturalWidth} / ${imageEl.naturalHeight}`);
      }
    }

    function getMediaBox() {
      const r = wrapEl.getBoundingClientRect();
      const isVideo = videoEl && videoEl.style.display !== 'none';
      const natW = isVideo ? videoEl.videoWidth  : imageEl.naturalWidth;
      const natH = isVideo ? videoEl.videoHeight : imageEl.naturalHeight;
      if (!natW || !natH) return { x:0, y:0, w:r.width, h:r.height };

      const mediaAR = natW / natH, wrapAR = r.width / r.height;
      if (wrapAR > mediaAR) {
        const h = r.height, w = h * mediaAR, x = (r.width - w) / 2;
        return { x, y:0, w, h };
      } else {
        const w = r.width, h = w / mediaAR, y = (r.height - h) / 2;
        return { x:0, y, w, h };
      }
    }

    function updateBanner(q){
      const text = q && q.topText ? String(q.topText) : '';
      if (text){
        topBanner.textContent = text; topBanner.hidden = false; topBanner.style.color = q.topColor || "";
      } else {
        topBanner.textContent = ''; topBanner.hidden = true; topBanner.style.color = "";
      }
    }

    function showImage(src, alt){
      try { videoEl.pause(); } catch {}
      while (videoEl.firstChild) videoEl.removeChild(videoEl.firstChild);
      videoEl.removeAttribute('src'); videoEl.removeAttribute('controls'); videoEl.style.display = 'none'; videoEl.ontimeupdate = null;

      overlayEl.innerHTML = '';

      imageEl.onload = () => { setAspectFromMedia(); redrawOverlay(); };
      imageEl.onerror = () => { showToast('⚠️ Image failed to load: ' + src); };
      imageEl.src = src; imageEl.alt = alt || 'TEE image'; imageEl.style.display = '';

      // draw immediately if cached
      if (imageEl.complete && imageEl.naturalWidth) {
        setAspectFromMedia(); redrawOverlay();
      }
    }

    function showVideo(q){
      imageEl.style.display = 'none';
      overlayEl.innerHTML = '';
      try { videoEl.pause(); } catch {}
      while (videoEl.firstChild) videoEl.removeChild(videoEl.firstChild);
      videoEl.removeAttribute('src'); videoEl.removeAttribute('controls'); videoEl.ontimeupdate = null;

      if (Array.isArray(q.sources) && q.sources.length){
        q.sources.forEach(s => {
          const source = document.createElement('source');
          source.src = s.src; if (s.type) source.type = s.type;
          videoEl.appendChild(source);
        });
      } else if (q.video){ videoEl.src = q.video; }

      videoEl.onloadedmetadata = () => {
        setAspectFromMedia();
        const start = typeof q.start === 'number' ? q.start : (typeof q.time === 'number' ? q.time : 0);
        const end   = typeof q.end   === 'number' ? q.end   : null;
        if (start) videoEl.currentTime = start;
        videoEl.ontimeupdate = end ? () => { if (videoEl.currentTime > end) videoEl.currentTime = start || 0; } : null;

        const tryPlay = () => videoEl.play().catch(() => { videoEl.setAttribute('controls',''); });
        if (q.autoplay) { tryPlay(); } else { videoEl.pause(); }
        redrawOverlay();
      };

      videoEl.onerror = () => showToast('⚠️ Video failed to load');
      videoEl.style.display = ''; videoEl.load();
    }

    function restart(){
      order = shuffle([...Array(ECHO_QUESTIONS.length).keys()]);
      while (ECHO_QUESTIONS[order[0]] && !ECHO_QUESTIONS[order[0]].target) {
        order.push(order.shift());
      }
      idx = 0; score = 0; updateMeta();
      showToast('New game started');
      loadQuestion();
    }

    function updateMeta(){
      scorePill.textContent = `Score: ${score}`;
      qPill.textContent = `${idx+1} / ${order.length}`;
      const pct = (idx / order.length) * 100;
      bar.style.inset = `0 ${100-pct}% 0 0`;
    }

    function loadQuestion(){
      const q = ECHO_QUESTIONS[order[idx]];
      updateBanner(q);

      if (q.video || q.sources){ showVideo(q); }
      else if (q.image){ showImage(q.image, q.hint ? `Question: ${q.hint}` : 'TEE image'); }
      else { showToast('⚠️ Question missing media'); }

      // Build answers
      answersEl.innerHTML = '';
      const options = shuffle(q.choices);
      options.forEach(txt => {
        const btn = document.createElement('button');
        btn.className = 'echo-btn'; btn.type = 'button'; btn.textContent = txt;
        btn.addEventListener('click', () => handleAnswer(btn, txt === q.answer));
        answersEl.appendChild(btn);
      });

      updateMeta();
      // Safety: ensure arrow draws after layout paint even on cached images
      setTimeout(redrawOverlay, 0);
    }

    function disableAnswers(){ answersEl.querySelectorAll('button').forEach(b => b.disabled = true); }

    // Scoring: wrong → no points, auto-advance
    function handleAnswer(btn, isCorrect){
      const q = ECHO_QUESTIONS[order[idx]];
      disableAnswers();

      if (isCorrect){
        btn.classList.add('echo-correct');
        score += 1; scorePill.textContent = `Score: ${score}`;
        try { if (q && q.label && q.target) placeLabel(q.label); } catch(e){}
        setTimeout(nextQuestion, 700);
      } else {
        btn.classList.add('echo-wrong');
        answersEl.classList.add('echo-shake');
        setTimeout(()=> answersEl.classList.remove('echo-shake'), 300);
        setTimeout(nextQuestion, 800);
      }
    }

    function placeLabel(text){
      if (!overlayEl) return;
      const q = ECHO_QUESTIONS[order[idx]];
      if (!q || !q.target) return;

      const r   = wrapEl.getBoundingClientRect();
      const box = getMediaBox();
      const x2  = box.x + box.w * (q.target.x/100);
      const y2  = box.y + box.h * (q.target.y/100);

      const x1 = clamp(x2 - 140, 20, r.width  - 20);
      const y1 = clamp(y2 - 100, 20, r.height - 20);

      const label = document.createElement('div');
      label.className = 'echo-arrow-label';
      label.style.left = x1 + 'px'; label.style.top  = y1 + 'px';
      label.textContent = text;
      overlayEl.appendChild(label);
    }

    function nextQuestion(){
      if(idx < order.length - 1){
        idx += 1; updateMeta(); loadQuestion();
      } else {
        finish();
      }
    }

    function finish(){
      overlayEl.innerHTML = '';
      answersEl.innerHTML = '';
      const done = document.createElement('div');
      done.style.padding = '22px';
      done.innerHTML = `<h2 style="margin:.2rem 0 .6rem;color:#e6edf9">Great job! 🎉</h2>
        <p style="color:#c2cce0; margin:0 0 1rem">You scored <strong>${score}</strong> / ${order.length}.</p>`;
      answersEl.appendChild(done);
      showToast('Game complete');
    }

    function showToast(msg){
      toast.textContent = msg;
      toast.classList.add('echo-show');
      clearTimeout(showToast._t);
      showToast._t = setTimeout(()=> toast.classList.remove('echo-show'), 1500);
    }

    function redrawOverlay(){
      const q = ECHO_QUESTIONS[order[idx]];
      overlayEl.innerHTML = '';
      if(!q || !q.target) return;

      const r   = wrapEl.getBoundingClientRect();
      const box = getMediaBox();
      const x2  = box.x + box.w * (q.target.x/100);
      const y2  = box.y + box.h * (q.target.y/100);

      const x1 = clamp(x2 - 140, 20, r.width  - 20);
      const y1 = clamp(y2 - 100, 20, r.height - 20);

      const svgNS = 'http://www.w3.org/2000/svg';
      const svg = document.createElementNS(svgNS, 'svg');
      svg.setAttribute('class','echo-svg');

      const defs = document.createElementNS(svgNS, 'defs');
      const marker = document.createElementNS(svgNS, 'marker');
      marker.setAttribute('id','echo-arrowhead');
      marker.setAttribute('markerWidth','10');
      marker.setAttribute('markerHeight','10');
      marker.setAttribute('refX','6');
      marker.setAttribute('refY','3');
      marker.setAttribute('orient','auto');
      const head = document.createElementNS(svgNS,'polygon');
      head.setAttribute('points','0 0, 6 3, 0 6');
      head.setAttribute('class','echo-arrow-head');
      marker.appendChild(head); defs.appendChild(marker); svg.appendChild(defs);

      const line = document.createElementNS(svgNS,'line');
      line.setAttribute('x1', x1); line.setAttribute('y1', y1);
      line.setAttribute('x2', x2); line.setAttribute('y2', y2);
      line.setAttribute('class','echo-arrow-line');
      line.setAttribute('marker-end','url(#echo-arrowhead)');
      svg.appendChild(line);
      overlayEl.appendChild(svg);

      const dot = document.createElement('div');
      dot.style.cssText = 'position:absolute;width:10px;height:10px;border-radius:999px;background:rgba(255,255,255,.85);box-shadow:0 0 10px rgba(255,255,255,.7);transform:translate(-50%,-50%);';
      dot.style.left = x2+'px'; dot.style.top = y2+'px';
      overlayEl.appendChild(dot);
    }

    // Init
    loadQuestion();
  </script>

</body>
</html>
